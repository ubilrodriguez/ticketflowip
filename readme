
ğŸ“Œ Proyecto: Ticket Flow
Sistema completo de gestiÃ³n de tickets, que incluye autenticaciÃ³n, sockets, panel de administraciÃ³n y visualizaciÃ³n de datos.

ğŸ§± Estructura del Proyecto
graphql
Copiar
Editar
ticket-flow/
â”œâ”€â”€ backend/       # Backend con NestJS y TypeORM
â””â”€â”€ frontend/      # Frontend con React y Vite
ğŸ› ï¸ TecnologÃ­as Utilizadas
Backend (ticket-flow-backend)
Framework: NestJS

ORM: TypeORM

Base de datos: MySQL

Seguridad: JWT + Passport

Websockets: Socket.IO

DocumentaciÃ³n API: Swagger

ValidaciÃ³n: class-validator + class-transformer

Estilo de cÃ³digo: ESLint + Prettier

Tests: Jest

Frontend (ticket-flow)
Framework: React 18

Empaquetador: Vite

Estilos: Tailwind CSS

GrÃ¡ficos: Chart.js + React Chart.js 2

AutenticaciÃ³n: JWT

Formulario: react-hook-form

Sockets: socket.io-client

UX/UI: Lucide, react-hot-toast

ğŸš€ Scripts de EjecuciÃ³n
Backend
bash
Copiar
Editar
# Desarrollo
npm run start:dev

# ProducciÃ³n
npm run start:prod

# Build
npm run build

# Tests
npm run test         # Unitarios
npm run test:e2e     # End-to-End
npm run test:cov     # Cobertura

# Linter y formato
npm run lint
npm run format
Frontend
bash
Copiar
Editar
# Desarrollo
npm run dev

# Build
npm run build

# Vista previa de build
npm run preview

# Iniciar frontend y backend a la vez
npm start
ğŸ§ª Testing
El backend usa Jest para pruebas unitarias y e2e.

Cobertura de cÃ³digo generada en coverage/.

ğŸ” Seguridad
AutenticaciÃ³n mediante JWT.

Estrategias de Passport: local y jwt.

ğŸ“Š Dashboard y VisualizaciÃ³n
Uso de Chart.js para representar mÃ©tricas del sistema.

Formateo de fechas con date-fns.

Manejo de notificaciones con react-hot-toast.

ğŸ“¡ ComunicaciÃ³n en Tiempo Real
Sockets integrados tanto en frontend como backend mediante Socket.IO para notificaciones y actualizaciones en vivo.

ğŸ“ DocumentaciÃ³n API
Accesible desde:

bash
Copiar
Editar
http://localhost:<puerto>/api-docs
(Generada con @nestjs/swagger)

ğŸ§© Notas Adicionales
Uso de estrategias de nombres personalizadas en TypeORM para consistencia con las bases de datos.

SeparaciÃ³n clara entre ambientes de desarrollo, testing y producciÃ³n.

Scripts automatizados para mantener el estilo de cÃ³digo limpio.


AquÃ­ tienes una **documentaciÃ³n profesional** del esquema SQL que has definido, ideal para compartir en un README tÃ©cnico, un archivo de diseÃ±o (`database.md`) o incluir en una wiki del equipo:

---

# ğŸ—‚ï¸ DiseÃ±o de Base de Datos â€” Ticket Flow (MySQL)

## ğŸ§¾ DescripciÃ³n General

Este esquema representa el diseÃ±o inicial de la base de datos para el sistema **Ticket Flow**, adaptado para entornos MySQL. Proporciona soporte completo para gestiÃ³n de tickets, usuarios, comentarios, notificaciones y archivos adjuntos.

---

## ğŸ“¦ Tablas Principales

### 1. `usuarios`

Almacena la informaciÃ³n de los usuarios del sistema.

| Campo           | Tipo                 | DescripciÃ³n                                            |
| --------------- | -------------------- | ------------------------------------------------------ |
| id              | `INT AUTO_INCREMENT` | Clave primaria                                         |
| uuid            | `VARCHAR(36)`        | UUID Ãºnico generado automÃ¡ticamente                    |
| nombre          | `VARCHAR(100)`       | Nombre completo                                        |
| email           | `VARCHAR(255)`       | Correo Ãºnico                                           |
| password        | `TEXT`               | Hash de contraseÃ±a                                     |
| rol             | `ENUM`               | Rol del usuario (`administrador`, `agente`, `cliente`) |
| activo          | `BOOLEAN`            | Estado activo/inactivo                                 |
| creado\_en      | `TIMESTAMP`          | Fecha de creaciÃ³n                                      |
| actualizado\_en | `TIMESTAMP`          | Ãšltima actualizaciÃ³n                                   |

---

### 2. `tickets`

Registra los tickets de soporte generados por los clientes.

| Campo          | Tipo          | DescripciÃ³n                                                        |
| -------------- | ------------- | ------------------------------------------------------------------ |
| numero\_ticket | `VARCHAR(20)` | Identificador legible generado automÃ¡ticamente                     |
| estado         | `ENUM`        | Estado del ticket: `abierto`, `en_progreso`, `resuelto`, `cerrado` |
| prioridad      | `ENUM`        | `Alta`, `Media`, `Baja`                                            |
| cliente\_id    | `INT`         | FK a `usuarios(id)`                                                |
| asignado\_id   | `INT`         | FK a `usuarios(id)` (puede ser NULL)                               |

---

### 3. `comentarios`

Comentarios registrados en los tickets.

| Campo       | Tipo      | DescripciÃ³n                        |
| ----------- | --------- | ---------------------------------- |
| es\_interno | `BOOLEAN` | Indica si el comentario es interno |
| ticket\_id  | `INT`     | FK a `tickets(id)`                 |
| usuario\_id | `INT`     | FK a `usuarios(id)`                |

---

### 4. `notificaciones`

Almacena mensajes de notificaciÃ³n asociados a los usuarios.

| Campo | Tipo          | DescripciÃ³n                    |
| ----- | ------------- | ------------------------------ |
| tipo  | `VARCHAR(50)` | Tipo de notificaciÃ³n           |
| leida | `BOOLEAN`     | Estado de lectura (true/false) |

---

### 5. `archivos_adjuntos`

Adjuntos vinculados a los tickets.

| Campo           | Tipo           | DescripciÃ³n                 |
| --------------- | -------------- | --------------------------- |
| nombre\_archivo | `VARCHAR(255)` | Nombre del archivo          |
| url\_archivo    | `TEXT`         | URL o path del archivo      |
| tipo\_archivo   | `VARCHAR(100)` | MIME type (opcional)        |
| tamaÃ±o\_bytes   | `BIGINT`       | TamaÃ±o del archivo en bytes |

---

## âš™ï¸ Funcionalidades Especiales

### ğŸ” GeneraciÃ³n AutomÃ¡tica de NÃºmeros de Ticket

* Se utiliza un **procedimiento almacenado (`GenerateTicketNumber`)** para crear un identificador tipo `TK-YYYYMMDD-0001`.
* Implementado mediante un **trigger `BEFORE INSERT`** en la tabla `tickets`.

---

### ğŸš€ Triggers y Stored Procedures

| Nombre                            | Tipo      | PropÃ³sito                                                       |
| --------------------------------- | --------- | --------------------------------------------------------------- |
| `GenerateTicketNumber`            | PROCEDURE | Genera nÃºmeros Ãºnicos por dÃ­a para los tickets                  |
| `set_ticket_number_before_insert` | TRIGGER   | Asigna automÃ¡ticamente el nÃºmero de ticket si no se proporciona |

---

## ğŸ§© Consideraciones para MySQL

* Se usa `AUTO_INCREMENT` en lugar de UUID como clave primaria por rendimiento.
* PolÃ­ticas RLS (Row Level Security) no estÃ¡n presentes en MySQL.
* Triggers y procedimientos adaptados con sintaxis especÃ­fica para MySQL.
* Compatibilidad con UTF8MB4 para soportar caracteres internacionales.

---

## ğŸ“ˆ Ãndices Agregados

Mejoran el rendimiento en bÃºsquedas frecuentes.

```sql
idx_tickets_cliente           --> tickets(cliente_id)
idx_tickets_asignado          --> tickets(asignado_id)
idx_tickets_estado            --> tickets(estado)
idx_tickets_numero            --> tickets(numero_ticket)
idx_comentarios_ticket        --> comentarios(ticket_id)
idx_notificaciones_usuario    --> notificaciones(usuario_id)
idx_archivos_ticket           --> archivos_adjuntos(ticket_id)
```

---

## ğŸ” Usuario por Defecto (opcional)

Incluye una lÃ­nea comentada para insertar un usuario administrador de forma manual.
âš ï¸ **Importante:** Recuerda reemplazar el hash del password por uno seguro generado en tu entorno real.

```sql
-- CAMBIAR LA CONTRASEÃ‘A EN PRODUCCIÃ“N
-- INSERT INTO usuarios (...) VALUES ('Administrador', 'admin@sistema.com', '$2y$10$example_hash_aqui', 'administrador');
```

---

## ğŸ“ Recomendaciones

* Agrega mÃ¡s validaciones a nivel de aplicaciÃ³n (NestJS) para mantener integridad.
* Si planeas escalar o migrar a PostgreSQL en el futuro, considera usar UUID como PK en un entorno desacoplado.
* Agrega control de versiones de esquema (ej: con TypeORM migrations o herramientas como Liquibase/Flyway).

---

Â¿Quieres que lo exporte como archivo `.md` o `.pdf`? Â¿O necesitas que genere el diagrama entidad-relaciÃ³n (ERD) a partir de este esquema?
